name: DB Init

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Optional environment label (e.g. staging, prod)'
        required: false

jobs:
  init-db:
    runs-on: [self-hosted, linux, target]
      
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r mongodb-pymongo-fastapi/requirements.txt

      - name: Run DB init
        env:
          MONGODB_URL: ${{ secrets.MONGODB_URL }}
        run: |
          echo "Running db_init.py"
          python mongodb-pymongo-fastapi/db_init.py
